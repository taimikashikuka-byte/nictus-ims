<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nictus Furniture IMS - Inventory Management</title>
  <style>
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background:#f9fafb; color:#333; }
    header { background:#2c3e50; color:#fff; padding:1.5rem; text-align:center; font-size:1.8rem; font-weight:700; }
    nav { background:#34495e; display:flex; flex-wrap:wrap; gap:1rem; padding:0.75rem 1.25rem; }
    nav a { color:#ecf0f1; font-weight:600; text-decoration:none; }
    nav a:hover { color:#1abc9c; }
    main { max-width:1100px; margin:2rem auto; padding:0 1rem; }

    section.card { background:#fff; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08); margin-bottom:1.5rem; padding:1.25rem; }
    section.card h2 { margin:0 0 1rem; color:#34495e; }

    #dashboard { display:flex; flex-wrap:wrap; gap:1rem; }
    .metric { background:#1abc9c; color:#fff; flex:1 1 220px; padding:1rem; border-radius:6px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .metric.low { background:#e67e22; }
    .metric h3 { margin:0; font-size:2rem; font-weight:800; }
    .metric p { margin:0; letter-spacing:0.04em; text-transform:uppercase; font-weight:600; }

    .actions { display:flex; flex-wrap:wrap; gap:0.5rem; margin-bottom:0.75rem; }
    .btn { display:inline-block; padding:0.55rem 0.9rem; border-radius:6px; border:1px solid transparent; font-weight:700; cursor:pointer; }
    .btn.primary { background:#1abc9c; color:#fff; }
    .btn.secondary { background:#fff; color:#34495e; border-color:#cfd6de; }
    .btn.warn { background:#e67e22; color:#fff; }

    table { width:100%; border-collapse:collapse; font-size:0.95rem; }
    th, td { border:1px solid #e5e7eb; padding:0.65rem 0.6rem; text-align:left; }
    th { background:#34495e; color:#fff; }
    tr:nth-child(even) { background:#f6f8fa; }
    td.status { font-weight:700; }
    .in-stock { color:#27ae60; }
    .low-stock { color:#e67e22; }
    .out-stock { color:#c0392b; }

    form label { display:block; margin-top:0.75rem; font-weight:700; color:#34495e; }
    form input, form select, form button { width:100%; padding:0.55rem 0.7rem; border:1px solid #cfd6de; border-radius:6px; }
    form input:focus, form select:focus { outline:none; border-color:#1abc9c; }
    form button { margin-top:0.75rem; }

    #scanner-preview { width:100%; max-width:340px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); margin-top:0.5rem; }

    .note { font-size:0.9rem; color:#5b6470; }
    .pill { display:inline-block; padding:0.1rem 0.5rem; border-radius:999px; background:#eef2f7; font-size:0.8rem; color:#475569; font-weight:700; }
    @media (max-width: 720px) { .metric h3 { font-size:1.6rem; } }
  </style>
</head>
<body>

<header>Nictus Furniture Inventory Management System</header>

<nav>
  <a href="#dashboard">Dashboard</a>
  <a href="#inventory-table-section">Inventory</a>
  <a href="#add-product-section">Add Product</a>
  <a href="#reorder-section">Reorder Suggestions</a>
  <a href="#scanner-section">Scan Barcode</a>
</nav>

<main>

  <!-- DASHBOARD -->
  <section id="dashboard" class="card" aria-label="Inventory summary dashboard">
    <div class="metric" aria-live="polite" aria-atomic="true">
      <h3 id="total-stock">0</h3>
      <p>Total Items in Stock</p>
    </div>
    <div class="metric low" aria-live="polite" aria-atomic="true">
      <h3 id="low-stock-alerts">0</h3>
      <p>Low Stock Alerts</p>
    </div>
    <div class="metric" aria-live="polite" aria-atomic="true">
      <h3 id="total-skus">0</h3>
      <p>Total Unique SKUs</p>
    </div>
    <div id="category-totals" style="flex:1 1 100%; display:flex; flex-wrap:wrap; gap:0.5rem; margin-top:0.75rem;">
      <!-- Category totals will appear here -->
    </div>
  </section>

  <!-- INVENTORY TABLE -->
  <section id="inventory-table-section" class="card" aria-label="Inventory items list">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
      <h2>Inventory Items</h2>
      <div class="actions">
        <button id="export-csv" class="btn secondary" title="Download inventory as CSV">Export CSV</button>
        <button id="export-pdf" class="btn secondary" title="Download inventory as PDF">Export PDF</button>
      </div>
    </div>
    <table id="inventory-table" role="grid" aria-describedby="inventory-description">
      <thead>
        <tr>
          <th scope="col">SKU</th>
          <th scope="col">Item Name</th>
          <th scope="col">Category</th>
          <th scope="col">Quantity</th>
          <th scope="col">Location</th>
          <th scope="col">Status</th>
        </tr>
      </thead>
      <tbody id="inventory-body"></tbody>
    </table>
    <p id="inventory-description" class="note">List of furniture items with stock status</p>
  </section>

  <!-- ADD PRODUCT -->
  <section id="add-product-section" class="card" aria-label="Add new inventory product">
    <h2>Add New Product</h2>
    <form id="add-product-form" novalidate>
      <label for="sku">SKU <span class="pill">leave blank to auto-generate</span></label>
      <input type="text" id="sku" name="sku" autocomplete="off" />
      <label for="name">Item Name</label>
      <input type="text" id="name" name="name" required autocomplete="off" />
      <label for="category">Category</label>
      <input type="text" id="category" name="category" required autocomplete="off" />
      <label for="quantity">Quantity</label>
      <input type="number" id="quantity" name="quantity" min="0" required />
      <label for="location">Location</label>
      <input type="text" id="location" name="location" required autocomplete="off" />
      <label for="status">Status</label>
      <select id="status" name="status" required>
        <option value="In Stock">In Stock</option>
        <option value="Low Stock">Low Stock</option>
        <option value="Out of Stock">Out of Stock</option>
      </select>
      <button type="submit" class="btn primary">Add Product</button>
    </form>
  </section>

  <!-- REORDER SUGGESTIONS -->
  <section id="reorder-section" class="card" aria-label="Reorder suggestions based on Min/Max policy">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
      <h2>Reorder Suggestions (Min/Max)</h2>
      <div class="actions">
        <button id="export-po" class="btn warn" title="Download purchase order CSV for suggested reorders">Generate Purchase Order (CSV)</button>
      </div>
    </div>
    <p class="note">Based on your proposalâ€™s objectives, this uses a simple category Min/Max rule to recommend reorder quantities. Edit the policy in the code if needed.</p>
    <table id="reorder-table">
      <thead>
        <tr>
          <th>SKU</th>
          <th>Name</th>
          <th>Category</th>
          <th>Qty</th>
          <th>Min</th>
          <th>Max</th>
          <th>Suggested Reorder</th>
        </tr>
      </thead>
      <tbody id="reorder-body"></tbody>
    </table>
  </section>

  <!-- SCANNER -->
  <section id="scanner-section" class="card" aria-label="Barcode scanner">
    <h2>Scan Barcode</h2>
    <p class="note">Use your device camera to scan a barcode or QR; the result will be placed in the SKU field.</p>
    <video id="scanner-preview" aria-live="polite" aria-label="Camera preview for barcode scanning"></video>
  </section>

</main>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<!-- jsPDF for PDF export -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

<!-- QR Scanner (ES module) -->
<script type="module">
import QrScanner from 'https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js';

// Firebase config (replace with your actual values)
const firebaseConfig = { apiKey:"YOUR_API_KEY", authDomain:"YOUR_PROJECT.firebaseapp.com", databaseURL:"https://YOUR_PROJECT.firebaseio.com", projectId:"YOUR_PROJECT", storageBucket:"YOUR_PROJECT.appspot.com", messagingSenderId:"YOUR_SENDER_ID", appId:"YOUR_APP_ID" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// In-memory inventory
const inventory = [];

// Min/Max policy
const CATEGORY_MIN_MAX = {
  "Beds": { min:10, max:40 }, "Dining Sets": { min:5, max:20 }, "TV Units": { min:8, max:25 },
  "Sofas": { min:6, max:18 }, "Wardrobes": { min:4, max:15 }, "Office Chairs": { min:10, max:50 },
  "Coffee Tables": { min:8, max:24 }, "Mattresses": { min:12, max:60 }, "Default": { min:5, max:20 }
};

function getStatusClass(status){ if(status==="In Stock") return "in-stock"; if(status==="Low Stock") return "low-stock"; if(status==="Out of Stock") return "out-stock"; return ""; }
function getMinMax(category){ return CATEGORY_MIN_MAX[category] || CATEGORY_MIN_MAX["Default"]; }
function generateSKU(){ return 'FUR'+Math.random().toString(36).substring(2,7).toUpperCase(); }

// Dashboard update
function updateDashboard() {
  const total = inventory.reduce((sum,item)=>sum+(Number(item.quantity)||0),0);
  const lowStockCount = inventory.filter(i=>i.status==="Low Stock"||(Number(i.quantity)||0)<=getMinMax(i.category).min).length;
  document.getElementById("total-stock").textContent = total;
  document.getElementById("low-stock-alerts").textContent = lowStockCount;
  document.getElementById("total-skus").textContent = inventory.length;

  // Category totals
  const categoryTotalsDiv = document.getElementById("category-totals");
  categoryTotalsDiv.innerHTML = "";
  const categoryMap = {};
  inventory.forEach(item => { if(!categoryMap[item.category]) categoryMap[item.category]=0; categoryMap[item.category]+=Number(item.quantity)||0; });
  Object.entries(categoryMap).forEach(([cat,totalQty]) => {
    const span = document.createElement("div");
    span.className="metric"; span.style.flex="1 1 180px"; span.style.background="#3498db";
    span.innerHTML=`<h3>${totalQty}</h3><p>${cat}</p>`;
    categoryTotalsDiv.appendChild(span);
  });
}

// Render tables
function renderInventoryTable() {
  const tbody = document.getElementById("inventory-body"); tbody.innerHTML="";
  inventory.forEach(item=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${item.sku}</td><td>${item.name}</td><td>${item.category}</td><td>${item.quantity}</td><td>${item.location}</td><td class="status ${getStatusClass(item.status)}">${item.status}</td>`;
    tbody.appendChild(tr);
  });
}

function renderReorderTable() {
  const tbody = document.getElementById("reorder-body"); tbody.innerHTML="";
  inventory.forEach(item=>{
    const {min,max} = getMinMax(item.category);
    const qty = Number(item.quantity)||0;
    if(qty<min){
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${item.sku}</td><td>${item.name}</td><td>${item.category}</td><td>${qty}</td><td>${min}</td><td>${max}</td><td>${Math.max(0,max-qty)}</td>`;
      tbody.appendChild(tr);
    }
  });
  if(!tbody.children.length){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td colspan="7" style="text-align:center; color:#556;">No items require reordering based on current Min/Max.</td>`;
    tbody.appendChild(tr);
  }
}

// Load inventory from Firebase
function loadInventory(){
  db.ref("inventory").on("value", snapshot=>{
    const data=snapshot.val()||{};
    inventory.length=0;
    Object.values(data).forEach(item=>inventory.push(item));
    renderInventoryTable();
    renderReorderTable();
    updateDashboard();
  });
}

// Add product
document.getElementById("add-product-form").addEventListener("submit", e=>{
  e.preventDefault();
  const form=e.target; let sku=form.sku.value.trim(); if(!sku){ sku=generateSKU(); form.sku.value=sku; }
  const newItem={ sku, name:form.name.value.trim(), category:form.category.value.trim(), quantity:Number(form.quantity.value), location:form.location.value.trim(), status:form.status.value };
  if(!newItem.name||!newItem.category||isNaN(newItem.quantity)||!newItem.location){ alert("Please fill all required fields."); return; }
  if(inventory.some(i=>i.sku===newItem.sku)){ alert("SKU already exists."); return; }
  db.ref("inventory/"+newItem.sku).set(newItem).then(()=>form.reset()).catch(err=>alert("Failed to add item: "+err.message));
});

// Barcode scan
const videoElem=document.getElementById("scanner-preview");
const qrScanner=new QrScanner(videoElem,result=>{ document.getElementById("sku").value=result; qrScanner.stop(); });
QrScanner.hasCamera().then(has=>{ if(has) qrScanner.start(); });

// CSV/PDF/PO exports (same as original)
// ... keep all previous export code unchanged ...

// Demo data
const demoData={
  "FUR384884": { sku:"FUR384884", name:"Dining Set 135", category:"Dining Sets", quantity:26, location:"Aisle 6 - Shelf 4", status:"In Stock" },
  "FUR714540": { sku:"FUR714540", name:"TV Unit 960", category:"TV Units", quantity:26, location:"Aisle 5 - Shelf 5", status:"In Stock" },
  "FUR729464": { sku:"FUR729464", name:"TV Unit 414", category:"TV Units", quantity:0, location:"Aisle 5 - Shelf 4", status:"Out of Stock" },
  "FUR815378": { sku:"FUR815378", name:"Bed 748", category:"Beds", quantity:32, location:"Aisle 9 - Shelf 5", status:"In Stock" },
  "FUR585060": { sku:"FUR585060", name:"Bed 605", category:"Beds", quantity:14, location:"Aisle 3 - Shelf 2", status:"Low Stock" }
};
firebase.database().ref("inventory").once("value", snap=>{ if(!snap.exists()) db.ref("inventory").set(demoData); });

// Start
loadInventory();
</script>
</body>
</html>
